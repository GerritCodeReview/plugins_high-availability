{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "d9a5af1b_6fe3ba06",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 13,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-04T21:24:11Z",
      "side": 1,
      "message": "This was reported as a bug, it should be in the form of:\nBug: Issue 12500",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 13,
        "endChar": 7
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8267514b_aff410a5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 13,
      "author": {
        "id": 1127770
      },
      "writtenOn": "2021-02-05T20:19:41Z",
      "side": 1,
      "message": "Thx for notice it will be change in next patchset",
      "parentUuid": "d9a5af1b_6fe3ba06",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 13,
        "endChar": 7
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8b9dd184_82a2dad8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 13,
      "author": {
        "id": 1127770
      },
      "writtenOn": "2021-02-10T17:27:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8267514b_aff410a5",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 13,
        "endChar": 7
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0fa6a25a_6b40dc80",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-04T21:24:11Z",
      "side": 1,
      "message": "I like the change, but I am concerned that is breaking compatibility with existing legacy API calls.\nLook at the suggestions inside my review on how to resolve the problem.\n\nTo test the interoperability, you should have a Gerrit v2.15 in HA with a Gerrit v2.16 *AND* a Gerrit v2.16 in HA with Gerrit v3.0, and they should work by propagating the indexing as normal.\n\nThat would allow people on Gerrit v2.15 to migrate to v2.16 with zero-downtime and then to migrate to Gerrit v3.0 with zero-downtime again.",
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e77432e6_f9e4b162",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1127770
      },
      "writtenOn": "2021-02-05T20:19:41Z",
      "side": 1,
      "message": "Thank You for your review. I know that job is not yet done please replay on my comments.",
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0df8644b_88fb377e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-06T00:29:49Z",
      "side": 1,
      "message": "Thanks for the replies, see some suggested approach to address the compatibility issues.",
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e9439859_bae60640",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarder.java",
        "patchSetId": 8
      },
      "lineNbr": 77,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-04T21:24:11Z",
      "side": 1,
      "message": "This would be a breaking change, as the API interface is changing.\nBear in mind that HA needs to be tolerant across different releases, to allow rolling upgrades.",
      "range": {
        "startLine": 77,
        "startChar": 21,
        "endLine": 77,
        "endChar": 33
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5c887343_ee8cfcd9",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarder.java",
        "patchSetId": 8
      },
      "lineNbr": 77,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-11T00:34:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e9439859_bae60640",
      "range": {
        "startLine": 77,
        "startChar": 21,
        "endLine": 77,
        "endChar": 33
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fc95f932_3b9e72fa",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarder.java",
        "patchSetId": 8
      },
      "lineNbr": 87,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-04T21:24:11Z",
      "side": 1,
      "message": "This would be a breaking change, as the API interface is changing.\nBear in mind that HA needs to be tolerant across different releases, to allow rolling upgrades.",
      "range": {
        "startLine": 87,
        "startChar": 21,
        "endLine": 87,
        "endChar": 27
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5ba350d9_f55ee747",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarder.java",
        "patchSetId": 8
      },
      "lineNbr": 87,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-11T00:34:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fc95f932_3b9e72fa",
      "range": {
        "startLine": 87,
        "startChar": 21,
        "endLine": 87,
        "endChar": 27
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "84694415_2a8ff019",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarder.java",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-04T21:24:11Z",
      "side": 1,
      "message": "This would be a breaking change, as the API interface is changing.\nBear in mind that HA needs to be tolerant across different releases, to allow rolling upgrades.",
      "range": {
        "startLine": 97,
        "startChar": 21,
        "endLine": 97,
        "endChar": 33
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "deb6639c_69d59bd0",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarder.java",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-11T00:34:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "84694415_2a8ff019",
      "range": {
        "startLine": 97,
        "startChar": 21,
        "endLine": 97,
        "endChar": 33
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "88bf42df_a89cc0fb",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarderServletModule.java",
        "patchSetId": 8
      },
      "lineNbr": 24,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-04T21:24:11Z",
      "side": 1,
      "message": "I would actually change this by inserting this logic in the servlet itself:\n- If receives the URL path with \u0027/batch\u0027 or \u0027/interactive\u0027, it will use the specific execution pool (interactive vs. batch)\n- If receives the URL path without any suffix, it will use the interactive execution pool.",
      "range": {
        "startLine": 23,
        "startChar": 4,
        "endLine": 24,
        "endChar": 86
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "405bb98d_3bfa5922",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarderServletModule.java",
        "patchSetId": 8
      },
      "lineNbr": 24,
      "author": {
        "id": 1127770
      },
      "writtenOn": "2021-02-05T20:19:41Z",
      "side": 1,
      "message": "This solution is based on:\nhttps://gerrit-review.googlesource.com/c/plugins/multi-site/+/253226\nThe difference is that instead of Kafka with new topic and subscriber new endpoint is used. So I think both solutions assume that customer will use new plugin version (this change should be deliver in all newest gerrit branches).\nCurrently in Servlet logic or consumer site (in multi site and HA) I didn\u0027t find separate execution pools on separate events. I think whole solution is based on idea that separate consumer or servlet will use separate thread.\nI can Try to change serveRegex to be more back compatible but I don\u0027t see here golden simple solution",
      "parentUuid": "88bf42df_a89cc0fb",
      "range": {
        "startLine": 23,
        "startChar": 4,
        "endLine": 24,
        "endChar": 86
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2209432b_149b3784",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarderServletModule.java",
        "patchSetId": 8
      },
      "lineNbr": 24,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-06T00:29:49Z",
      "side": 1,
      "message": "Why don\u0027t you then follow the same approach like in Change-Id: I0d10cd9cde and you just add an extra endpoint, instead of renaming both of them? The approach to reuse the existing as the interactive one and just adding a new one for batch was exactly for this purpose: any existing old version were still sharing the interactive topic whilst the new version was pointing to the new batch endpoint.\n\nThat is simple enough and would address this concern. WDYT?",
      "parentUuid": "405bb98d_3bfa5922",
      "range": {
        "startLine": 23,
        "startChar": 4,
        "endLine": 24,
        "endChar": 86
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2230c7a5_1c1a26f7",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarderServletModule.java",
        "patchSetId": 8
      },
      "lineNbr": 24,
      "author": {
        "id": 1127770
      },
      "writtenOn": "2021-02-08T22:33:20Z",
      "side": 1,
      "message": "Approach from Change-Id: I0d10cd9cde was abandoned after @Marco Miller review. Check current approach. Now is forward and back compatible. I check that older plugins that uses: serveRegex(\"/index/change/.*) endpoint can catch end process successfully request (index/change/batch). I also check that new plugin version can process both batch requests from older and new plugin. serveRegex(\"/index/change/(?!batch/.*).*$\") is a guard that this endpoint will not process /index/change/batch/ request.",
      "parentUuid": "2209432b_149b3784",
      "range": {
        "startLine": 23,
        "startChar": 4,
        "endLine": 24,
        "endChar": 86
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2f7ab75e_e58904ca",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/RestForwarderServletModule.java",
        "patchSetId": 8
      },
      "lineNbr": 24,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-11T00:34:54Z",
      "side": 1,
      "message": "Negative regex are very slow in Java though. Why not just catch everything after \u0027/index/change/\u0027 and delegate the check in the Servlet?",
      "parentUuid": "2230c7a5_1c1a26f7",
      "range": {
        "startLine": 23,
        "startChar": 4,
        "endLine": 24,
        "endChar": 86
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "51f9ed65_109ad4cd",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/index/IndexEventHandler.java",
        "patchSetId": 8
      },
      "lineNbr": 88,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-04T21:24:11Z",
      "side": 1,
      "message": "This is a hack, but I guess we cannot do anything different, isn\u0027t it?\nI believe you got inspired by the same change in multi-site ;-)",
      "range": {
        "startLine": 88,
        "startChar": 22,
        "endLine": 88,
        "endChar": 72
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c0b3faaa_7b1b1d8f",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/index/IndexEventHandler.java",
        "patchSetId": 8
      },
      "lineNbr": 88,
      "author": {
        "id": 1127770
      },
      "writtenOn": "2021-02-05T20:19:41Z",
      "side": 1,
      "message": "Yes the idea was to port multi-site fix to HA plugin (this is also mention in commit msg). I stick as close as possible to original solution to reduce maintenance cost and risk of regression.",
      "parentUuid": "51f9ed65_109ad4cd",
      "range": {
        "startLine": 88,
        "startChar": 22,
        "endLine": 88,
        "endChar": 72
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f16e1276_5ffc1f5f",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/index/IndexEventHandler.java",
        "patchSetId": 8
      },
      "lineNbr": 88,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-06T00:29:49Z",
      "side": 1,
      "message": "Yep, SGTM.",
      "parentUuid": "c0b3faaa_7b1b1d8f",
      "range": {
        "startLine": 88,
        "startChar": 22,
        "endLine": 88,
        "endChar": 72
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fcc39111_9578b3cc",
        "filename": "src/test/java/com/ericsson/gerrit/plugins/highavailability/index/ChangeIndexForwardingIT.java",
        "patchSetId": 8
      },
      "lineNbr": 27,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-02-06T00:29:49Z",
      "side": 1,
      "message": "Keep the current interactive endpoint to \u0027/change/\u0027 so that we don\u0027t break backward compatibility.",
      "range": {
        "startLine": 27,
        "startChar": 52,
        "endLine": 27,
        "endChar": 64
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "40bb9800_2ce09cc6",
        "filename": "src/test/java/com/ericsson/gerrit/plugins/highavailability/index/ChangeIndexForwardingIT.java",
        "patchSetId": 8
      },
      "lineNbr": 27,
      "author": {
        "id": 1127770
      },
      "writtenOn": "2021-02-08T22:33:20Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fcc39111_9578b3cc",
      "range": {
        "startLine": 27,
        "startChar": 52,
        "endLine": 27,
        "endChar": 64
      },
      "revId": "75b2ccba45d6f600d1c81ecbd6557c946afe5c88",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}