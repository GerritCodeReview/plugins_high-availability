{
  "comments": [
    {
      "key": {
        "uuid": "6273155e_da9c5f3c",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/AccountReindexRunnable.java",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-08-15T19:26:01Z",
      "side": 1,
      "message": "Move this class and all the auto reindex related ones into their own package (com.ericsson.gerrit.plugins.highavailability.autoreindex)?",
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "96e6d515_952240c0",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/AccountReindexRunnable.java",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T19:57:51Z",
      "side": 1,
      "message": "Yes, makes sense.\nWill address in the next PS.",
      "parentUuid": "6273155e_da9c5f3c",
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c1e25705_fc558b16",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/AccountReindexRunnable.java",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T22:14:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "96e6d515_952240c0",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2efa57ae_d0c5a68c",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/AutoReindexListener.java",
        "patchSetId": 5
      },
      "lineNbr": 29,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-08-15T19:26:01Z",
      "side": 1,
      "message": "Very subjective but I think something like AutoReindexScheduler is a better name as it represent what the class is doing: scheduling the AutoReindex tasks.",
      "range": {
        "startLine": 29,
        "startChar": 13,
        "endLine": 29,
        "endChar": 32
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4209ec63_c22035b4",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/AutoReindexListener.java",
        "patchSetId": 5
      },
      "lineNbr": 29,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T19:57:51Z",
      "side": 1,
      "message": "I believe you are right. It listens to the Gerrit lifecycle events, but its role is to schedule the indexers, it is then a \"scheduler\" more than a \"listener\".",
      "parentUuid": "2efa57ae_d0c5a68c",
      "range": {
        "startLine": 29,
        "startChar": 13,
        "endLine": 29,
        "endChar": 32
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a62ac634_b35a4a7c",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/AutoReindexListener.java",
        "patchSetId": 5
      },
      "lineNbr": 29,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T22:14:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4209ec63_c22035b4",
      "range": {
        "startLine": 29,
        "startChar": 13,
        "endLine": 29,
        "endChar": 32
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "960f7462_632e1f0f",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/AutoReindexListener.java",
        "patchSetId": 5
      },
      "lineNbr": 54,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-08-15T19:26:01Z",
      "side": 1,
      "message": "If you apply all my other comments, you will end up will all the auto reindex classes in their own package so I would also create a AutoReindexModule with all the bindings and this if would move in the main module class:\n\nif (config.index().autoReindex().enabled) {\n  install(new AutoReindexModule());\n}",
      "range": {
        "startLine": 54,
        "startChar": 4,
        "endLine": 54,
        "endChar": 24
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5b3a26cc_f4118e4a",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/AutoReindexListener.java",
        "patchSetId": 5
      },
      "lineNbr": 54,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T22:14:46Z",
      "side": 1,
      "message": "Yes, makes sense. Looks very clean now and instantiated in a similar way to the other components.",
      "parentUuid": "960f7462_632e1f0f",
      "range": {
        "startLine": 54,
        "startChar": 4,
        "endLine": 54,
        "endChar": 24
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e9ef01f1_dd72d4c8",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/AutoReindexListener.java",
        "patchSetId": 5
      },
      "lineNbr": 76,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-08-15T19:26:01Z",
      "side": 1,
      "message": "We also need to call exec.shutdown and exec.unregisterWorkQueue, see ExecutorProvider class for example",
      "range": {
        "startLine": 76,
        "startChar": 14,
        "endLine": 76,
        "endChar": 18
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "59c76b48_6c3b21f2",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/AutoReindexListener.java",
        "patchSetId": 5
      },
      "lineNbr": 76,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T22:14:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e9ef01f1_dd72d4c8",
      "range": {
        "startLine": 76,
        "startChar": 14,
        "endLine": 76,
        "endChar": 18
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "394292f6_0248f978",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-08-15T19:26:01Z",
      "side": 1,
      "message": "If you apply my comment below, this class will be easy to move in the autoreidex package",
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "59cb4ab9_edd8e34d",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T19:57:51Z",
      "side": 1,
      "message": "Yes, will do.",
      "parentUuid": "394292f6_0248f978",
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "103afd45_130f84e5",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T22:14:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "59cb4ab9_edd8e34d",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8760e9ff_1cede4c3",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 35,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-08-15T19:26:01Z",
      "side": 1,
      "message": "In a following change, you are updating the index TS on the sender node in addition to the receiving node which is in this change.\n\nI suggest in order to make this change smaller to  implement ChangeIndexedListener, AccountIndexedListenera and GroupIndexedListener in this class and update the TS when an indexing event is happening (this will cover both sending and receiving node). This way this class will be more self contained.",
      "range": {
        "startLine": 35,
        "startChar": 13,
        "endLine": 35,
        "endChar": 20
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ccfdb44b_d5563210",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 35,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T19:57:51Z",
      "side": 1,
      "message": "Yes, it will be more contained. However, it would break the SRP IMHO, there are design reasons to keep them separate.",
      "parentUuid": "8760e9ff_1cede4c3",
      "range": {
        "startLine": 35,
        "startChar": 13,
        "endLine": 35,
        "endChar": 20
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "81751ef3_716bbc3c",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 35,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-08-15T20:29:47Z",
      "side": 1,
      "message": "If we consider the responsibility of this class to keep track of indexing TS, I do not see how listing to indexing events to be able to maintain indexing TS be against SRP.\n\nDoing that would allow the Forwarded*handler and IndexEventHandler to not have a dependency on IndexTS",
      "parentUuid": "ccfdb44b_d5563210",
      "range": {
        "startLine": 35,
        "startChar": 13,
        "endLine": 35,
        "endChar": 20
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1c2403c7_2f7a31ed",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 35,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T20:36:46Z",
      "side": 1,
      "message": "Let me try to change it as you suggested and let\u0027s see how it looks like.",
      "parentUuid": "81751ef3_716bbc3c",
      "range": {
        "startLine": 35,
        "startChar": 13,
        "endLine": 35,
        "endChar": 20
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a29a9dc3_9cda8474",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 35,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T22:14:46Z",
      "side": 1,
      "message": "I believe that I know where you are driving me towards: why can\u0027t this be just a standalone functionality, independent from the high-availability plugin altogether?\n\nMain points are:\n- It has its own module\n- It has its own package\n- It has its own configuration\n- It is hooked to the Index event listeners on its own\n\nI believe, however, that it will miss some important functionality though, such as the prevention of the \"looping\" of index forwarding back and forth.\n\nExample:\n\nNote A and B are not aligned, because A was in trouble and crashed before sending all the reindex events to Node B.\nIf auto-reindex is triggered on B, it will still forward all the events back to A, which isn\u0027t needed.\n\nHowever, this discussion is very similar to the \"should we forward the on-line reindex events\" one :-) and I know we have different opinions on that.\n\nLet me complete the changes with your suggestions, that make sense anyway. Then we can decide if is worth splitting this work into a new plugin or keep it in high-availability.\n\nWhat do you think?",
      "parentUuid": "1c2403c7_2f7a31ed",
      "range": {
        "startLine": 35,
        "startChar": 13,
        "endLine": 35,
        "endChar": 20
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4fccc18e_321d1194",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 35,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-08-16T00:17:16Z",
      "side": 1,
      "message": "\u003e I believe that I know where you are driving me towards: why can\u0027t this be just a standalone functionality, independent from the high-availability plugin altogether?\n\nNope, I was only pushing you towards an implementation that is more isolated and slightly more simple. I definitely want this change in HA plugin.",
      "parentUuid": "a29a9dc3_9cda8474",
      "range": {
        "startLine": 35,
        "startChar": 13,
        "endLine": 35,
        "endChar": 20
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ff775ac9_c0fc60f3",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 35,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-16T17:20:07Z",
      "side": 1,
      "message": "\u003e \u003e I believe that I know where you are driving me towards: why can\u0027t this be just a standalone functionality, independent from the high-availability plugin altogether?\n\u003e \n\u003e Nope, I was only pushing you towards an implementation that is more isolated and slightly more simple. I definitely want this change in HA plugin.\n\nSounds good, and thanks again for your thoughful reviews :-)",
      "parentUuid": "4fccc18e_321d1194",
      "range": {
        "startLine": 35,
        "startChar": 13,
        "endLine": 35,
        "endChar": 20
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c04ea87d_5b3801bd",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 80,
      "author": {
        "id": 1012987
      },
      "writtenOn": "2018-08-15T19:26:01Z",
      "side": 1,
      "message": "this will no longer need to be public if you apply my comment above",
      "range": {
        "startLine": 80,
        "startChar": 14,
        "endLine": 80,
        "endChar": 20
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bcb60c84_65419872",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/rest/IndexTs.java",
        "patchSetId": 5
      },
      "lineNbr": 80,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2018-08-15T19:57:51Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "c04ea87d_5b3801bd",
      "range": {
        "startLine": 80,
        "startChar": 14,
        "endLine": 80,
        "endChar": 20
      },
      "revId": "cfd17abffd0523d654baa90a3ab41024d5926e7a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}