{
  "comments": [
    {
      "key": {
        "uuid": "10861ca3_8125e007",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-20T21:54:05Z",
      "side": 1,
      "message": "nit: wrap long line",
      "range": {
        "startLine": 10,
        "startChar": 64,
        "endLine": 10,
        "endChar": 78
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8d869be7_4f703571",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-20T21:54:05Z",
      "side": 1,
      "message": "on",
      "range": {
        "startLine": 10,
        "startChar": 57,
        "endLine": 10,
        "endChar": 59
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cd87c347_f1553e57",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T08:26:23Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "10861ca3_8125e007",
      "range": {
        "startLine": 10,
        "startChar": 64,
        "endLine": 10,
        "endChar": 78
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "be4b140c_cebf7c0d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T08:26:23Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "8d869be7_4f703571",
      "range": {
        "startLine": 10,
        "startChar": 57,
        "endLine": 10,
        "endChar": 59
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a071bc24_e58b57b6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 16,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-20T21:54:05Z",
      "side": 1,
      "message": "flagged as forwarded and not re-forwarded",
      "range": {
        "startLine": 15,
        "startChar": 64,
        "endLine": 16,
        "endChar": 30
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c2f969a2_fae5a40c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 16,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T08:26:23Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "a071bc24_e58b57b6",
      "range": {
        "startLine": 15,
        "startChar": 64,
        "endLine": 16,
        "endChar": 30
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d44bef5f_93297b3d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 16,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-21T08:36:41Z",
      "side": 1,
      "message": "Forgot to amend the text? It was just a nit anyway, it\u0027s up to you.",
      "parentUuid": "c2f969a2_fae5a40c",
      "range": {
        "startLine": 15,
        "startChar": 64,
        "endLine": 16,
        "endChar": 30
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "78e18420_a58d8d17",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 16,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T09:00:20Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d44bef5f_93297b3d",
      "range": {
        "startLine": 15,
        "startChar": 64,
        "endLine": 16,
        "endChar": 30
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8c42499c_09427711",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-20T21:54:05Z",
      "side": 1,
      "message": "The event source check",
      "range": {
        "startLine": 18,
        "startChar": 0,
        "endLine": 18,
        "endChar": 4
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3be0de67_cda9fda5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T08:26:23Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "8c42499c_09427711",
      "range": {
        "startLine": 18,
        "startChar": 0,
        "endLine": 18,
        "endChar": 4
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "56ad6199_c1b0e06a",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBroker.java",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-20T22:00:32Z",
      "side": 1,
      "message": "Need to check that both event.instanceId and gerritInstanceId are !\u003d null\nOnly in that case, we can check the source of the event.\n\nIf one of the two is null, the result is \"we don\u0027t know\" and therefore we need to be conservative and forward the event anyway.\n\nWithout configuring any instanceId in Gerrit, this change should be a NO-OP",
      "range": {
        "startLine": 49,
        "startChar": 11,
        "endLine": 49,
        "endChar": 35
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a0e405ce_eb8477dd",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBroker.java",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T08:26:23Z",
      "side": 1,
      "message": "If an event carries information about what GerritInstanceId produced it (say, \"GerritA\") and we know that *this* Gerrit is not *that* instance (because its GerritInstanceId is null and not \"GerritA\"), can we not infer that the message was produced somewhere else?",
      "parentUuid": "56ad6199_c1b0e06a",
      "range": {
        "startLine": 49,
        "startChar": 11,
        "endLine": 49,
        "endChar": 35
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0903e889_dcb752b4",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBroker.java",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-21T08:36:41Z",
      "side": 1,
      "message": "You are right: if the instanceId wasn\u0027t set in the gerrit.config then the event would have not have had that field filled in. Makes sense.",
      "parentUuid": "a0e405ce_eb8477dd",
      "range": {
        "startLine": 49,
        "startChar": 11,
        "endLine": 49,
        "endChar": 35
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e463d70a_6dd89c16",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBroker.java",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T08:59:20Z",
      "side": 1,
      "message": "Thinking again over this, we should always be able to say whether the event was produced by this Gerrit, unless both event.instanceId and gerrit.instanceId are null.\nI think the truth table should be as follows:\n\n* event.instanceId: null - gerrit.instanceId: null -\u003e false (we don\u0027t know, it could have been produced by *any* gerrit not having gerrit.instanceId).\n* event.instanceId: A    - gerrit.instanceId: null -\u003e true  (if gerrit had produced that event, event.instanceId would have been null)\n* event.instanceId: null - gerrit.instanceId: B    -\u003e true  (if gerrit had produced that event, event.instanceId would have been B)\n* event.instanceId: A    - gerrit.instanceId: B    -\u003e true  (they differ)\n\nIf you agree I\u0027ll change this logic accordingly, WDYT?",
      "parentUuid": "0903e889_dcb752b4",
      "range": {
        "startLine": 49,
        "startChar": 11,
        "endLine": 49,
        "endChar": 35
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c050ebdf_0d01d435",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBroker.java",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T09:02:12Z",
      "side": 1,
      "message": "And obviously there\u0027s one missing:\n\nevent.instanceId: A    - gerrit.instanceId: A    -\u003e false  (they are the same)",
      "parentUuid": "e463d70a_6dd89c16",
      "range": {
        "startLine": 49,
        "startChar": 11,
        "endLine": 49,
        "endChar": 35
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f5a81178_affdbec5",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBroker.java",
        "patchSetId": 1
      },
      "lineNbr": 49,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-21T09:17:24Z",
      "side": 1,
      "message": "Correct. So basically, you could change the method name to \u0027isProducedByLocalInstance\u0027 and do:\n   return Objects.equals(event.instanceId, gerritInstanceId)\n\nSee the behaviour of Objects.equals:\nhttps://docs.oracle.com/javase/7/docs/api/java/util/Objects.html",
      "parentUuid": "c050ebdf_0d01d435",
      "range": {
        "startLine": 49,
        "startChar": 11,
        "endLine": 49,
        "endChar": 35
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a958081d_2939be45",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBroker.java",
        "patchSetId": 1
      },
      "lineNbr": 58,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-20T22:00:32Z",
      "side": 1,
      "message": "This comment is more appropriate before L49 as it describes the rationale behind the instanceId logic.",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 58,
        "endChar": 74
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b6acd41f_4121af7a",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBroker.java",
        "patchSetId": 1
      },
      "lineNbr": 58,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T08:26:23Z",
      "side": 1,
      "message": "I don\u0027t think this comment describes the rationale behind the instanceId logic. At least that wasn\u0027t the intent.\nTo me this comment describes the meaning of \"forwarded\" and how the \"forwarded\" context is affected *by* checking instanceId.\n\nL49\u0027s purpose is to check whether the event is produced by a different Gerrit instance, but it makes no assumptions on how that information will be used.\nFor these reasons I think this comment belongs here.\n\nHope it makes sense, WDYT?",
      "parentUuid": "a958081d_2939be45",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 58,
        "endChar": 74
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5f7d24b9_dda73ee6",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBroker.java",
        "patchSetId": 1
      },
      "lineNbr": 58,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-21T08:36:41Z",
      "side": 1,
      "message": "The first two lines, yes. The other three lines, no, they explain how instanceId is related to the forwarding logic, which is exactly the name of the method \u0027isProducedByDifferentInstazce\u0027.\n\nFrom the caller\u0027s perspective, he doesn\u0027t care HOW the producer detection is calculated, so it is irrelevant to document here those implementation details.\n\nRemember that comments are THE ONLY piece of code that aren\u0027t tested and they don\u0027t break tests if they are wrong. So it is best to minimise the chance of getting them stale.",
      "parentUuid": "b6acd41f_4121af7a",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 58,
        "endChar": 74
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "625f2f11_bc0e1ed9",
        "filename": "src/main/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBroker.java",
        "patchSetId": 1
      },
      "lineNbr": 58,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T08:59:20Z",
      "side": 1,
      "message": "I see what you mean, makes sense.\n\nLet me fix that.",
      "parentUuid": "5f7d24b9_dda73ee6",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 58,
        "endChar": 74
      },
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c7e55baf_ec402253",
        "filename": "src/test/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBrokerTest.java",
        "patchSetId": 1
      },
      "lineNbr": 72,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-21T08:36:41Z",
      "side": 1,
      "message": "Nit: unrelated change",
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "37d9c026_33ceaec7",
        "filename": "src/test/java/com/ericsson/gerrit/plugins/highavailability/forwarder/ForwardedAwareEventBrokerTest.java",
        "patchSetId": 1
      },
      "lineNbr": 72,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-21T08:59:20Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "c7e55baf_ec402253",
      "revId": "723efe960fd43542b25cafd5bc779dd7aa92a09f",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}