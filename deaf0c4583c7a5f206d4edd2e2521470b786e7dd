{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "7280e5c7_522131f5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 11,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T09:49:38Z",
      "side": 1,
      "message": "why is the JGit cache an issue ?",
      "range": {
        "startLine": 11,
        "startChar": 34,
        "endLine": 11,
        "endChar": 44
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "151e4f01_41e76b8f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 11,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-11-12T12:30:14Z",
      "side": 1,
      "message": "This is related to when core.trustfolderstat is set to true, hence the JGit cache is out of sync with the underlying filesystem when the files/dirs stats are cached.\n\n@Marcin can you clarify and add more background information?",
      "parentUuid": "7280e5c7_522131f5",
      "range": {
        "startLine": 11,
        "startChar": 34,
        "endLine": 11,
        "endChar": 44
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5bd5e207_9f0d4dd7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 11,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-11-12T12:41:17Z",
      "side": 1,
      "message": "JGit cache is a write through cache so if we have two masters which are sharing the same repo and we have change which is going through master 1 we are sure that mastar 1 has an up to date cache. But we cannot guarantee that for master 2. That\u0027s why we are using global-refdb to check if we have consistent view of the repo across masters",
      "parentUuid": "7280e5c7_522131f5",
      "range": {
        "startLine": 11,
        "startChar": 34,
        "endLine": 11,
        "endChar": 44
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bd60d281_fc4de949",
        "filename": "/COMMIT_MSG",
        "patchSetId": 9
      },
      "lineNbr": 11,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T13:35:07Z",
      "side": 1,
      "message": "In your example JGit cache of master 1 is a write through cache, but master 2 needs to see an updated timestamp of the objects/pack directory (if core.trustfolderstat is set to true) in order to rescan the pack folder and recognise that there is a new packfile which arrived in the shared filesystem via the other host and update its transient list of known packfiles before it can access objects in the new pack. On the first access to an object in the new pack it will load and cache the pack index and then load the page of the packfile containing that object into the JGit cache. This could lead to MissingObjectExceptions if the new pack isn\u0027t yet visible to JGit on master 2 due to NFS caching. How does global-refdb help to avoid this situation ?",
      "parentUuid": "5bd5e207_9f0d4dd7",
      "range": {
        "startLine": 11,
        "startChar": 34,
        "endLine": 11,
        "endChar": 44
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3db20425_d473af75",
        "filename": "external_plugin_deps.bzl",
        "patchSetId": 9
      },
      "lineNbr": 18,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T09:49:38Z",
      "side": 1,
      "message": "can we please move this repo to gerrit-review ?",
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9f970213_544546c8",
        "filename": "external_plugin_deps.bzl",
        "patchSetId": 9
      },
      "lineNbr": 18,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-11-12T12:30:14Z",
      "side": 1,
      "message": "I believe it was proposed but suggested that could be a feature closer to JGit rather than Gerrit.",
      "parentUuid": "3db20425_d473af75",
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "65347ed6_e0197313",
        "filename": "external_plugin_deps.bzl",
        "patchSetId": 9
      },
      "lineNbr": 18,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-11-12T12:41:17Z",
      "side": 1,
      "message": "we can discuss that with @Luca but this should be a followup change",
      "parentUuid": "3db20425_d473af75",
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "66e36581_81cc02a9",
        "filename": "external_plugin_deps.bzl",
        "patchSetId": 9
      },
      "lineNbr": 18,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-11-12T12:43:08Z",
      "side": 1,
      "message": "Ah sorry we commented almost at the same time ðŸ˜Š If we decided to move it let\u0027s do it as a separate change",
      "parentUuid": "65347ed6_e0197313",
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6983b0ec_f7828f2b",
        "filename": "external_plugin_deps.bzl",
        "patchSetId": 9
      },
      "lineNbr": 18,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T13:35:07Z",
      "side": 1,
      "message": "ok, we can also discuss integrating that API in JGit, then also other applications using JGit may benefit from it",
      "parentUuid": "66e36581_81cc02a9",
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5ad9455_8b25774e",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 114,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T09:49:38Z",
      "side": 1,
      "message": "which database server ? I thought master is using notedb ...",
      "range": {
        "startLine": 114,
        "startChar": 2,
        "endLine": 114,
        "endChar": 24
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "929e41fd_84db1c0c",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 114,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-11-12T12:41:17Z",
      "side": 1,
      "message": "We already discussed that. Documentation is outdated I\u0027ve just copied the Active/passive section and added steps to enable global ref-db. I\u0027ve prepared separate change for the documentation update(https://gerrit-review.googlesource.com/c/plugins/high-availability/+/287028)",
      "parentUuid": "b5ad9455_8b25774e",
      "range": {
        "startLine": 114,
        "startChar": 2,
        "endLine": 114,
        "endChar": 24
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2a8a5719_9f5462ba",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 114,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T13:35:07Z",
      "side": 1,
      "message": "then this other change should be a predecessor of this change and you can skip this bullet point here",
      "parentUuid": "929e41fd_84db1c0c",
      "range": {
        "startLine": 114,
        "startChar": 2,
        "endLine": 114,
        "endChar": 24
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "33c44fec_4589b5f2",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 114,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-11-12T14:15:08Z",
      "side": 1,
      "message": "Yes that\u0027s the plan but the change is for stable-3.0 so we have to merge it up to master first",
      "parentUuid": "2a8a5719_9f5462ba",
      "range": {
        "startLine": 114,
        "startChar": 2,
        "endLine": 114,
        "endChar": 24
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "12264cff_09f2f191",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 115,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T09:49:38Z",
      "side": 1,
      "message": "so still NFS ?",
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4d68f47c_afc3bff6",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 115,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-11-12T12:41:17Z",
      "side": 1,
      "message": "Yes we still need to share the git repositories",
      "parentUuid": "12264cff_09f2f191",
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "191b0259_2c5ae463",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 115,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T13:35:07Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "4d68f47c_afc3bff6",
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3bd46d09_c0c8008c",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 127,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T09:49:38Z",
      "side": 1,
      "message": "what is this ?",
      "range": {
        "startLine": 127,
        "startChar": 54,
        "endLine": 127,
        "endChar": 69
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "547f63a8_7af62b2d",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 127,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-11-12T12:41:17Z",
      "side": 1,
      "message": "Same as above. Documentation is outdated for Active/passive as well. There is a separate change for the documentation update",
      "parentUuid": "3bd46d09_c0c8008c",
      "range": {
        "startLine": 127,
        "startChar": 54,
        "endLine": 127,
        "endChar": 69
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6c03bf8_a2544f61",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 150,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T09:49:38Z",
      "side": 1,
      "message": "for which service are these credentials used ?",
      "range": {
        "startLine": 148,
        "startChar": 0,
        "endLine": 150,
        "endChar": 21
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e835069f_1508b5b8",
        "filename": "src/main/resources/Documentation/about.md",
        "patchSetId": 9
      },
      "lineNbr": 150,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-11-12T12:41:17Z",
      "side": 1,
      "message": "Same as above. Copied from original documentation. Here is the parameters description(from the documentation):\nhttp.user : Username to connect to the peer instance.\nhttp.password : Password to connect to the peer instance.",
      "parentUuid": "a6c03bf8_a2544f61",
      "range": {
        "startLine": 148,
        "startChar": 0,
        "endLine": 150,
        "endChar": 21
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "109fbcee_98df8296",
        "filename": "src/main/resources/Documentation/config.md",
        "patchSetId": 9
      },
      "lineNbr": 246,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-11-12T09:49:38Z",
      "side": 1,
      "message": "I think \"409 - Conflict\" would be a better fit, it\u0027s not an unexpected internal server error but the current state (ref not yet in sync) doesn\u0027t allow processing this request.\n\nIn addition a Retry-After header could give an ETA when this request could be retried\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Retry-After",
      "range": {
        "startLine": 246,
        "startChar": 16,
        "endLine": 246,
        "endChar": 48
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7ba8bc1f_08186c9a",
        "filename": "src/main/resources/Documentation/config.md",
        "patchSetId": 9
      },
      "lineNbr": 246,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-11-12T12:30:14Z",
      "side": 1,
      "message": "+1",
      "parentUuid": "109fbcee_98df8296",
      "range": {
        "startLine": 246,
        "startChar": 16,
        "endLine": 246,
        "endChar": 48
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a5205409_1b7068ad",
        "filename": "src/main/resources/Documentation/config.md",
        "patchSetId": 9
      },
      "lineNbr": 246,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-11-12T12:41:17Z",
      "side": 1,
      "message": "Yes you are right but this requires changes in global-refdb library which is shared across ha plugin and multisite plugin. Current change is about adopting global-refdb as it is now. Could we do that refactoring as a follow up change?",
      "parentUuid": "109fbcee_98df8296",
      "range": {
        "startLine": 246,
        "startChar": 16,
        "endLine": 246,
        "endChar": 48
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "082ab820_1ff86e74",
        "filename": "src/main/resources/Documentation/config.md",
        "patchSetId": 9
      },
      "lineNbr": 246,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-11-12T12:46:37Z",
      "side": 1,
      "message": "\u003e Yes you are right but this requires changes in global-refdb library which is shared across ha plugin and multisite plugin. \n\nWhere? Can you provide a link?",
      "parentUuid": "a5205409_1b7068ad",
      "range": {
        "startLine": 246,
        "startChar": 16,
        "endLine": 246,
        "endChar": 48
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cee02894_7e97c2b5",
        "filename": "src/main/resources/Documentation/config.md",
        "patchSetId": 9
      },
      "lineNbr": 246,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-11-12T14:15:08Z",
      "side": 1,
      "message": "If I\u0027m correct when we have a failure in global ref-db we are returning LOCK_FAILURE\nhttps://review.gerrithub.io/plugins/gitiles/GerritForge/global-refdb/+/refs/heads/master/src/main/java/com/gerritforge/gerrit/globalrefdb/validation/BatchRefUpdateValidator.java#117\n\nThan we are converting LOCK_FAILURE to LockFailureException\nhttps://gerrit.googlesource.com/gerrit/+/refs/heads/stable-3.3/java/com/google/gerrit/git/RefUpdateUtil.java#100\n\nAnd then we are converting LockFailureException to generic UpdateException\nhttps://gerrit.googlesource.com/gerrit/+/refs/heads/stable-3.3/java/com/google/gerrit/server/update/BatchUpdate.java#229",
      "parentUuid": "082ab820_1ff86e74",
      "range": {
        "startLine": 246,
        "startChar": 16,
        "endLine": 246,
        "endChar": 48
      },
      "revId": "deaf0c4583c7a5f206d4edd2e2521470b786e7dd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}